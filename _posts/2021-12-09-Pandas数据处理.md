title:  "Pandas æ•°æ®å¤„ç†"
date:   2021-12-09 15:38:20 +0800
tags:
      - example9
---
# Pandas



## æ•¸æ“šæº–å‚™å·¥ä½œ

> â€‹		é»¨æ‚¨ç²å–åˆ°æ•¸æ“šæ™‚ï¼Œå¾€å¾€æ•¸æ“šæ˜¯å†—é›œä¸”ç´›äº‚çš„ã€‚å› æ­¤ï¼Œæˆ‘å€‘éœ€è¦å°æ•¸æ“šé€²è¡Œä¸€ç³»åˆ—çš„æº–å‚™å·¥ä½œï¼Œå¦‚ï¼šåŠ è¼‰ï¼Œçµ„è£ï¼Œåˆªé™¤ç­‰â€¦â€¦â€¦â€¦ã€‚ï¼ˆç•¶ç„¶ï¼Œä¸€èˆ¬å®˜æ–¹åº«çš„æ•¸æ“šå‡æ˜¯è™•ç†å®Œå‚™å¯ä»¥ç›´æ¥é€²è¡Œä½¿ç”¨çš„



### æ•¸æ“šåˆå¹¶

â€‹	**æ•¸æ“šåˆå¹¶å‰‡ä½¿ç”¨å‡½æ•¸ pd.merge(DataFrame_1ï¼Œ DataFrame_2)ï¼Œåœ¨ä½¿ç”¨æ™‚éœ€æ³¨æ„ï¼Œéœ€ä¿æŒå…©å€‹ DataFrame å°è±¡çš„é•·åº¦ä¸€è‡´ã€‚**

â€‹	**æ•´å€‹åˆå¹¶éç¨‹é¡ä¼¼æ–¼ â€œäº¤â€ æ“ä½œï¼Œå³ä¿ç•™ columnsçš„å€¼ç›¸åŒçš„é …ï¼Œå„… columns ä¸­æœ‰å¤šé … Index ç›¸åŒæ™‚ï¼Œå‰‡(å¾ˆå¤§å¯èƒ½)æœƒç¯©é™¤æ‰æ›´å¤šçš„æ•¸æ“šã€‚å…·é«”è«‹çœ‹ä¸‹æ–¹å¯¦ä¾‹ã€‚**

```python
frame1 = pd.DataFrame({"id":["A", "B", "C", "D"],
                       "values":[100, 200, 300, 500]})
print(frame1)

frame2 = pd.DataFrame({"id":["A", "B","E", "C"],
                        "values":[500, 200, 300, 500]})
print()
print(pd.merge(frame1, frame2))
-------------------------------------
  id  values
0  A     100
1  B     200
2  C     300
3  D     500

  id  values
0  B     200
```

```python
frame1 = pd.DataFrame({"id":["A", "B", "C", "D"],
                       "values":[100, 200, 300, 500]})
print(frame1)

frame2 = pd.DataFrame({"id":["A", "B","E", "C"],
                       "objects":["a", "c", "e", "f"]})
print()
print(pd.merge(frame1, frame2))
-----------------------------------------
  id  values
0  A     100
1  B     200
2  C     300
3  D     500

  id  values objects
0  A     100       a
1  B     200       c
2  C     300       f
```

â€‹	**å¯ä»¥çœ‹åˆ°ï¼Œå„…é€²è¡Œåˆå¹¶æ™‚ï¼Œè‹¥2å€‹ DataFrame å°è±¡çš„ Columns ç›¸åŒï¼Œå‰‡æœƒç¯©é™¤æ‰æ›´å¤šçš„æ•¸æ“šï¼ˆå› è¦ä¿è­‰æ•¸æ“šæ›´é«˜çš„ç›¸åŒæ€§ï¼‰ï¼Œè‹¥æœ‰é¡å¤–çš„ Columns_value å‡ºç¾ï¼Œå‰‡æœƒé™„åŠ åœ¨å¾Œé‚Šï¼ˆå¦‚ objects æ‰€ç¤ºï¼‰ã€‚**



â€‹	**å¦å¤–ï¼Œä¹Ÿå¯ä»¥è¨­ç½®åƒæ•¸ on = ""ï¼Œä¾†æŒ‡å®šå‡½æ•¸é€²è¡Œåˆå¹¶æ‰€é¸çš„åˆ—ã€‚**	

```python
frame1 = pd.DataFrame({"id":["A", "B", "C", "D"],
                       "values":[100, 200, 300, 500],
                       "objects":["da", "da", "qwe", "qwe"]},
                        )
frame2 = pd.DataFrame({"id":["A", "B","E", "C"],
                       "objects":["a", "c", "e", "f"]})
print(pd.merge(frame1, frame2))
print()
print(pd.merge(frame1, frame2, on="id"))
------------------------------------------------
Empty DataFrame
Columns: [id, values, objects]
Index: []

  id  values objects_x objects_y
0  A     100        da         a
1  B     200        da         c
2  C     300       qwe         f
```

â€‹		**ç¾åœ¨æ‚¨æ¸…æ¥šäº†å§ã€‚(ä¸æ˜¯**



â€‹	**é‚£éº½ï¼Œé»¨å…©å€‹ DataFrame å°è±¡æ²’æœ‰ç›¸åŒçš„ columns å€¼è©²æ€éº½è¾¦å‘¢ï¼Ÿè‹¥åœ¨æ­¤æ™‚ç”¨ä¸Šè¿°çš„æ–¹æ³•é€²è¡Œåˆå¹¶ï¼Œé‚£éº½æœ€å¾Œçµæœå‡æ˜¯ç©ºåˆ—è¡¨ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š**

```python
frame1 = pd.DataFrame({"id":["A", "B", "C", "D"],
                       "values":[100, 200, 300, 500],
                       "objects":["da", "da", "qwe", "qwe"]},
                        )
frame2 = pd.DataFrame({"sid":["A", "B","E", "C"],
                       "objects":["a", "c", "e", "f"]})
print(pd.merge(frame1, frame2))

-------------------------------------
Empty DataFrame
Columns: [id, values, objects, sid]
Index: []

```



â€‹	**é€™æ™‚ï¼Œæˆ‘å€‘å°±å¯ä»¥ä½¿ç”¨ DataFrame() ä¸­çš„åƒæ•¸ left_on å’Œ right_onï¼Œä¾†æŒ‡å®šåˆå¹¶æ™‚éœ€è¦é€²è¡Œæ¯”è¼ƒçš„ Columns çš„å€¼ã€‚ç•¶ç„¶ï¼Œæ—¢å¯ä»¥ä½¿ç”¨ key å€¼é€²è¡ŒæŒ‡å®šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç´¢å¼•å€¼ï¼ˆleft_index)ã€‚**

```python
print(pd.merge(frame1, frame2,left_on="id", right_on="sid"))
-----------------------------
 id  values objects_x sid objects_y
0  A     100        da   A         a
1  B     200        da   B         c
2  C     300       qwe   C         f
```



â€‹	**åœ¨é€£æ¥æ™‚ï¼Œä¹Ÿå¯ä»¥å° how = â€œâ€ åƒæ•¸é€²è¡Œèª¿æ•´ä»¥æ”¹è®Šéˆæ¥çš„æ–¹å¼ã€‚how = "left" é€²è¡Œå·¦é€£æ¥ï¼›how = "right" é€²è¡Œå³éˆæ¥ï¼Œ how = "outer"é€²è¡Œå¤–é€£æ¥ã€‚æ­¤è™•çš„ä¸‰ç¨®éˆæ¥æ–¹å¼èˆ‡æ•¸æ“šåº«ä¸­çš„å®šç¾©ç›¸åŒï¼Œä¾¿ä¸å†é€²è¡Œé—¡é‡‹ã€‚**



â€‹	**è‹¥è¦æ ¹æ“šç´¢å¼•é€²è¡Œåˆå¹¶ï¼Œå¯ä½¿ç”¨ pd.merge(left_index =True, right_index = True) æˆ– ä½¿ç”¨ DataFrame.join() ä¾†é€²è¡Œåˆå¹¶ã€‚ï¼ˆå³æ©«å‘åŒ¹é…**

```python
frame1 = pd.DataFrame({"id":["A", "B", "C", "D"],
                       "values":[100, 200, 300, 500],
                       "objects":["da", "da", "qwe", "qwe"]},
                        )
frame2 = pd.DataFrame({"sid":["A", "B","E", "C", "Q"],
                       "objects":["a", "c", "e", "f", "haha"]})
print(pd.merge(frame1, frame2))
# print()
# print(pd.merge(frame1, frame2,left_on="id", right_on="sid"))

print(pd.merge(frame1, frame2, left_index=True, right_index=True))
--------------------------------------
Empty DataFrame
Columns: [id, values, objects, sid]
Index: []

  id  values objects_x sid objects_y
0  A     100        da   A         a
1  B     200        da   B         c
2  C     300       qwe   E         e
3  D     500       qwe   C         f

```

â€‹	

**ç„¶è€Œè‹¥ä½¿ç”¨ frame1.join(frame2)ï¼Œå‰‡æœƒå ±éŒ¯ã€‚å› çˆ²æ­¤æ™‚ frame1 å’Œ frame 2çš„ columns å…·æœ‰é‡è¤‡çš„å€¼ã€‚**

```
frame1 = pd.DataFrame({"id":["A", "B", "C", "D"],
                       "values":[100, 200, 300, 500],
                       "objects":["da", "da", "qwe", "qwe"]},
                        )
frame2 = pd.DataFrame({"sid":["A", "B","E", "C", "G"],
                       "objects1":["a", "c", "e", "f", "haha"]})
print()
print(frame1.join(frame2))
--------------------------------------
  id  values objects sid objects1
0  A     100      da   A        a
1  B     200      da   B        c
2  C     300     qwe   E        e
3  D     500     qwe   C        f

```





### æ•¸æ“šæ‹¼æ¥

> éœ€è¦ç”¨åˆ°çš„å‡½æ•¸ï¼š
>
> â€‹	pd.concat()ï¼ŒåŒ…æ‹¬åƒæ•¸ï¼š[åºåˆ—]ï¼Œ keysï¼Œaxisã€‚

â€‹	**åœ¨é€²è¡Œæ•¸æ“šæº–å‚™æ™‚ï¼Œæ•¸æ“šï¼ˆæˆ–ç¨±çˆ²æ•¸çµ„æ›´å®¹æ˜“ç†è§£ï¼‰çš„æ‹¼æ¥ä¹Ÿæ˜¯å¸¸åšçš„å·¥ä½œã€‚**

â€‹	**ä¸é›£æƒ³è±¡ï¼Œæ‹¼æ¥æ—¢æœ‰ç«ªå‘æ‹¼æ¥ï¼Œä¹Ÿæœ‰æ©«å‘æ‹¼æ¥ã€‚**



â€‹	**ç°¡å–®çš„æ‹¼æ¥ï¼ˆæ³¨æ„é€™å€‹æ–¹æ‹¬è™Ÿå“¦~ï¼‰**

```python
frame1 = pd.DataFrame(np.arange(9).reshape(3, 3),
                      columns=["A", "B", "C"],
                      index=["a", "b", "c"])
frame2 = pd.DataFrame(np.arange(9).reshape(3, 3),
                      columns=["D", "E", "F"],
                      index=["d", "e", "f"])

print()
print(pd.concat([frame1, frame2]))
-----------------------------------------
     A    B    C    D    E    F
a  0.0  1.0  2.0  NaN  NaN  NaN
b  3.0  4.0  5.0  NaN  NaN  NaN
c  6.0  7.0  8.0  NaN  NaN  NaN
d  NaN  NaN  NaN  0.0  1.0  2.0
e  NaN  NaN  NaN  3.0  4.0  5.0
```

â€‹	

â€‹	**é€šé key åƒæ•¸ï¼Œä¾†è¾¨åˆ¥æ‹¼æ¥è€Œæˆçš„å„å€‹éƒ¨åˆ†**

```python

frame1 = pd.DataFrame(np.arange(9).reshape(3, 3),
                      columns=["A", "B", "C"],
                      index=["a", "b", "c"])
frame2 = pd.DataFrame(np.arange(9).reshape(3, 3),
                      columns=["D", "E", "F"],
                      index=["d", "e", "f"])
print(pd.concat([frame1, frame2], keys = ["First", "Second"]))
-----------------------------------------
            A    B    C    D    E    F
First  a  0.0  1.0  2.0  NaN  NaN  NaN
       b  3.0  4.0  5.0  NaN  NaN  NaN
       c  6.0  7.0  8.0  NaN  NaN  NaN
Second d  NaN  NaN  NaN  0.0  1.0  2.0
       e  NaN  NaN  NaN  3.0  4.0  5.0
       f  NaN  NaN  NaN  6.0  7.0  8.0
```



â€‹	**æ ¹æ“š axis åƒæ•¸ï¼Œä¾†èª¿æ•´æ‹¼æ¥çš„æ–¹å‘ï¼Œå…¶é»˜èªï¼Œ axis = 0å³ç‚ºæ©«å‘æ‹¼æ¥ï¼›é»¨ axis = 1æ™‚ï¼Œå‰‡ç«ªè‘—å¹¶åˆ—ã€‚**

```python
frame1 = pd.DataFrame(np.arange(9).reshape(3, 3),
                      columns=["A", "B", "C"],
                      index=["a", "b", "c"])
frame2 = pd.DataFrame(np.arange(9).reshape(3, 3),
                      columns=["D", "E", "F"],
                      index=["d", "e", "f"])
print(pd.concat([frame1, frame2], keys = ["First", "Second"], axis=1))
----------------------------------
  First           Second          
      A    B    C      D    E    F
a   0.0  1.0  2.0    NaN  NaN  NaN
b   3.0  4.0  5.0    NaN  NaN  NaN
c   6.0  7.0  8.0    NaN  NaN  NaN
d   NaN  NaN  NaN    0.0  1.0  2.0
e   NaN  NaN  NaN    3.0  4.0  5.0
f   NaN  NaN  NaN    6.0  7.0  8.0
```





### æ•¸æ“šçµ„åˆ

â€‹	**æ›¸ä¸Šå¯«åˆ°ï¼Œå„…å…©å€‹æ•¸æ“šé›†çš„ç´¢å¼•å®Œå…¨æˆ–éƒ¨åˆ†ç›¸åŒæ™‚ï¼Œå¯ä»¥é€šéâ€œçµ„åˆâ€ ä¾†çµ„åˆæ•¸æ“šã€‚ï¼ˆä¸æ˜¯å¾ˆèƒ½ç†è§£ï¼‰ä¸éé‚„æ˜¯ä¾†è¬›è¬›å‡½æ•¸çš„å…·é«”ä½¿ç”¨æ–¹æ³•ã€‚**

â€‹	**ä½¿ç”¨DataFrame.combine_first( ) å‡½æ•¸å³å¯é”åˆ°é€²è¡Œçµ„åˆçš„ç›®çš„ã€‚**

```python
frame1 = pd.DataFrame(np.arange(9).reshape(3, 3),
                      columns=["A", "B", "C"],
                      index=["a", "b", "c"])

frame2 = pd.DataFrame(np.arange(16).reshape(4, 4),
                      columns=["C","D", "E", "F"],
                      index=["c","d", "e", "f"])

print(frame1.combine_first(frame2))
----------------------------------------
     A    B     C     D     E     F
a  0.0  1.0   2.0   NaN   NaN   NaN
b  3.0  4.0   5.0   NaN   NaN   NaN
c  6.0  7.0   8.0   1.0   2.0   3.0
d  NaN  NaN   4.0   5.0   6.0   7.0
e  NaN  NaN   8.0   9.0  10.0  11.0
f  NaN  NaN  12.0  13.0  14.0  15.0

```

â€‹	**æœ€å¾Œé”åˆ°çš„æ•ˆæœï¼Œé¡ä¼¼æ–¼æ‹¼æ¥ + å¡«å……ï¼ˆå³è‡ªå·±æ²’æœ‰çš„å¯ä»¥å¾å¦å¤–ä¸€å€‹ DataFrame ä¸­æ‹¿å‡ºä¾†)ã€‚**



### è»¸å‘æ—‹è½‰



â€‹	**é»¨ä½ æƒ³æŠŠåˆ— è½‰åŒ–ç‚º è¡Œæ™‚ï¼Œå¯ä»¥ä½¿ç”¨ DataFrame.stack()å‡½æ•¸ã€‚æ¼”ç¤ºå¦‚ä¸‹ï¼š**

```python
import pandas as pd
import numpy as np

frame1 = pd.DataFrame(np.arange(9).reshape(3, 3),
                      columns=["A", "B", "C"],
                      index=["a", "b", "c"])

print(frame1)
print()
print(frame1.stack())
------------------------------
   A  B  C
a  0  1  2
b  3  4  5
c  6  7  8

a  A    0
   B    1
   C    2
b  A    3
   B    4
   C    5
c  A    6
   B    7
   C    8
dtype: int32
```



â€‹	**ä½¿ç”¨å‡½æ•¸ DataFrame.unstack()å¯ä»¥æŠŠè¡Œè½‰æ›ç‚ºåˆ—ï¼ˆå³ stack() çš„é€†éç¨‹)ã€‚**

```python

frame1 = pd.DataFrame(np.arange(9).reshape(3, 3),
                      columns=["A", "B", "C"],
                      index=["a", "b", "c"])

print(frame1)
print()
print(frame1.unstack())
------------------------------
   A  B  C
a  0  1  2
b  3  4  5
c  6  7  8

A  a    0
   b    3
   c    6
B  a    1
   b    4
   c    7
C  a    2
   b    5
   c    8
dtype: int32
```



â€‹	**é‹ç”¨ DataFrame.pivot(index=ï¼Œ columns =ï¼Œ values = ) æ—¢å¯ä»¥æå– åŸå°è±¡columnså±¬æ€§ä¸‹å¯èƒ½å¤šæ¬¡å‡ºç¾çš„å€¼ï¼Œç„¶å¾Œä»¥é”åˆ°å°‡ "ç˜¦"çš„æ•¸æ“šè®Šæˆ"èƒ–"æ•¸æ“šçš„ç›®çš„ã€‚ï¼ˆå¯èƒ½è§£é‡‹çš„ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œå…·é«”è«‹çœ‹ä¸‹æ–¹çš„æ¼”ç¤ºã€‚**

```python
data = {'date': ['2018-08-01', '2018-08-02', '2018-08-03', '2018-08-01', '2018-08-03', '2018-08-03',
                 '2018-08-01', '2018-08-02'],
        'variable': ['A','A','A','B','B','C','C','C'],
        'value': [3.0 ,4.0 ,6.0 ,2.0 ,8.0 ,4.0 ,10.0 ,1.0 ]}

frame2 = pd.DataFrame(data, columns=["date", "variable", "value"])
print(frame2)
print()
print(frame2.pivot(index="date", columns="variable",values="value"))
--------------------------------------------------
         date variable  value
0  2018-08-01        A    3.0
1  2018-08-02        A    4.0
2  2018-08-03        A    6.0
3  2018-08-01        B    2.0
4  2018-08-03        B    8.0
5  2018-08-03        C    4.0
6  2018-08-01        C   10.0
7  2018-08-02        C    1.0

variable      A    B     C
date                      
2018-08-01  3.0  2.0  10.0
2018-08-02  4.0  NaN   1.0
2018-08-03  6.0  8.0   4.0

Process finished with exit code 0

```



### åˆªé™¤

â€‹	**åˆªé™¤å¯åˆ†çˆ²åˆªé™¤è¡Œæˆ–åˆªé™¤åˆ—ï¼ŒåŒç¬¬å››ç« æ‰€è¬›çš„ä¸€æ¨£ï¼Œå¯ä»¥é€šé del å’Œ DataFrame.drop() ä¾†é”åˆ°åˆªé™¤çš„ç›®çš„ã€‚æ¥ä¸‹ä¾†å°‡æœƒåœ¨ä¸‹æ–‡ä¸€ä¸€é—¡è¿°ã€‚**



â€‹	**ä½¿ç”¨ del æ™‚è¦æ³¨æ„ï¼Œåªèƒ½å° columns é€²è¡Œåˆªé™¤ï¼Œè€Œä¸èƒ½å° index é€²è¡Œåˆªé™¤ã€‚**

```python
df = pd.DataFrame(np.arange(9).reshape(3, 3),
                  columns=["A", "B", "C"],
                  index=["a", "b", "c"])
print(df)
del df["A"]
print()
print(df)
-----------------------------
   A  B  C
a  0  1  2
b  3  4  5
c  6  7  8

   B  C
a  1  2
b  4  5
c  7  8
```



â€‹	**é€šé DataFrame.drop() å³å¯åˆªé™¤ä½ æƒ³åˆªé™¤çš„è¡Œï¼ˆå³ç´¢å¼•:index)**

```python
df = pd.DataFrame(np.arange(9).reshape(3, 3),
                  columns=["A", "B", "C"],
                  index=["a", "b", "c"])
print(df)
df = df.drop("a")
print()
print(df)
-----------------------------
   A  B  C
a  0  1  2
b  3  4  5
c  6  7  8

   A  B  C
b  3  4  5
c  6  7  8                 
```





## æ•¸æ“šè½‰æ›

### åˆªé™¤é‡è¤‡çš„å…ƒç´ 

â€‹	**ç•¶ä½ çš„æ•¸æ“šä¸­å‡ºç¾é‡è¤‡çš„æ•¸æ“šåï¼Œä½ å¯èƒ½æœƒè€ƒæ…®å°‡å…¶åˆªé™¤æ‰ï¼Œä¹Ÿå¯èƒ½æœƒä¸ã€‚ï¼ˆä¸æ˜¯**

â€‹	**é€šé DataFrame.duplicated() å¯ä»¥ä¾†æª¢æ¸¬é‡è¤‡å‡ºç¾çš„æ•¸æ“šã€‚**

â€‹	**ps: å°æ–¼é€™ç¨®é€²è¡Œåˆ¤æ–·çš„å‡½æ•¸ï¼Œå¤§éƒ¨åˆ†ï¼ˆä¸ç¢ºå®šï¼‰å¯ç”¨æ–¼X[X.xxxx()] æ¢ä»¶åˆ¤æ–·ä¸­ç”¨æ–¼ç”Ÿæˆå°æ‡‰çš„å–®å€‹å…ƒç´ ã€‚**

```
df = pd.DataFrame({"color":["red", "red", "blue", "green", "yellow"],
                   "values":[1, 1, 3, 5, 5]})

print(df)
print()
print(df.duplicated())
print()
print(df[df.duplicated()])
--------------------------------
    color  values
0     red       1
1     red       1
2    blue       3
3   green       5
4  yellow       5

0    False
1     True
2    False
3    False
4    False
dtype: bool

  color  values
1   red       1
```





### æ˜ å°„é—œä¿‚

â€‹	**å°æ–¼æ˜ å°„é—œä¿‚çš„ç†è§£ï¼Œå¯ä»¥è¯æƒ³ PYTHON ä¸­çš„å­—å…¸ã€‚åœ¨å­—å…¸ä¸­ï¼Œ key å’Œ value ä¸€ä¸€å°æ‡‰ï¼Œé€™å°±æ˜¯ä¸€ç¨®æ˜ å°„é—œä¿‚ã€‚**

â€‹	

#### æ›¿æ›å…ƒç´ 

â€‹	**é€šéæ˜ å°„ï¼Œå¯ä»¥å¯¦ç¾å°‡å…ƒç´ æ›¿æ›çš„æ•ˆæœã€‚ä½¿ç”¨ DataFrame.replace() å³å¯é”åˆ°ã€‚å…¶ä¸­çš„åƒæ•¸ç‚º {old: new}é€™ç¨®ã€‚**

```python
df = pd.DataFrame({"objects":["pen", "pencil", "bigpen"],
                   "values":[100, 300, 500]})
print(df)
df = df.replace({"pen":"bigbigpen","bigpen":"littlepen"})
print(df)
-------------------------
  objects  values
0     pen     100
1  pencil     300
2  bigpen     500

     objects  values
0  bigbigpen     100
1     pencil     300
2  littlepen     500
```



#### æ·»åŠ å…ƒç´ 

â€‹	**é€šéæ˜ å°„é—œä¿‚ï¼Œæˆ‘å€‘é‚„å¯ä»¥å¾€æ•¸æ“šè£é‚Šæ·»åŠ ä¸€åˆ—ã€‚éœ€è¦ä½¿ç”¨åˆ° DataFrame.map()ã€‚**

```python
df = pd.DataFrame({"objects":["pen", "pencil", "bigpen"],
                   "values":[100, 300, 500]})

price = {100: 123, 300: 456, 500: 789}
df["price"] = df["values"].map(price)
print(df)
-----------------------------------------
  objects  values  price
0     pen     100    123
1  pencil     300    456
2  bigpen     500    789
```

â€‹	**é€šéå‰ä¸€åˆ—çš„æ•¸æ“šå’Œæ˜ å°„é—œä¿‚ï¼Œå³å¯å°‡ price æˆåŠŸæ·»åŠ åˆ° DataFrame ä¸­å»ã€‚**



#### è»¸çš„é‡å‘½å

â€‹	**ç•¶ä½ å°ä½ çš„è»¸çš„åç¨±ä¸æ»¿æ„æ™‚ï¼Œä½ ä¹Ÿå¯ä»¥å°å…¶é€²è¡Œæ›´æ”¹ã€‚å¤§è‡´æ–¹å¼èˆ‡ğŸ‘†æ–‡è™•æ·»åŠ å…ƒç´ ä¸€è‡´ã€‚åªä¸éæ­¤è™•èª¿ç”¨çš„å¹¶é .map() è€Œæ˜¯ .rename()ã€‚**

```python
df = pd.DataFrame(np.arange(25).reshape(5, 5),
                  columns=["A", "B", "C", "D", "E",],
                  index=["a", "b", "c", "d", "e"])
print(df)

reindex_ = {"A": "AAAAA",
           "B": "BBBBB",
           "C": "CCCCC",
           "D": "DDDDD",
           "E": "EEEEE"}

df = df.rename(columns=reindex_)
print()
print(df)
-----------------------------
    A   B   C   D   E
a   0   1   2   3   4
b   5   6   7   8   9
c  10  11  12  13  14
d  15  16  17  18  19
e  20  21  22  23  24

   AAAAA  BBBBB  CCCCC  DDDDD  EEEEE
a      0      1      2      3      4
b      5      6      7      8      9
c     10     11     12     13     14
d     15     16     17     18     19
e     20     21     22     23     24

```

â€‹	**æ­¤è™•éœ€æ³¨æ„ï¼Œè‹¥ç›´æ¥å‚³å…¥å­—å…¸åƒæ•¸ï¼Œå‰‡å…¶é»˜èªä¿®æ”¹çš„æ˜¯ index ï¼Œè‹¥è¦å°è¡Œï¼ˆè¡¨é ­ï¼‰é€²è¡Œä¿®æ”¹ï¼Œéœ€è¦é¡¯æ€§çš„å¯«å‡º columns = xxxxã€‚**





## é›¢æ•£åŒ–å’Œé¢å…ƒåŠƒåˆ†

â€‹	**ç”±æ–¼æˆ‘å€‘å’Œç®—æ³•å°æ•¸æ“šçš„ä¸åŒéœ€æ±‚ï¼Œæˆ‘å€‘å¯èƒ½æœƒéœ€è¦é›¢æ•£åŒ–çš„æ•¸æ“šï¼Œä¹Ÿå¯èƒ½æœƒéœ€è¦é€£çºŒçš„æ•¸æ“šï¼Œå› æ­¤å°æ•¸æ“šé€²è¡Œé›¢æ•£åŒ–ä¹Ÿæ˜¯ä¸€å€‹éå¸¸é‡è¦çš„éç¨‹ã€‚**

â€‹	**ç°¡å–®ä¾†èª¬ï¼Œå°‡é€£çºŒçš„æ•¸æ“šæ‹†åˆ†é–‹çš„éç¨‹å°±å«é›¢æ•£åŒ–ï¼Œæ‰€æ‹†åˆ†çš„ä¸€çµ„ä¸€çµ„çš„å°±æ˜¯â€œé¢å…ƒã€‚â€(é›¢æ•£åŒ–å’Œé¢å…ƒåŠƒåˆ†å…¶å¯¦å°±æ˜¯ä¸€é¡æ±è¥¿å•¦**



â€‹	**é€²è¡ŒåŠƒåˆ†å‰ï¼Œå¯ä»¥å…ˆé€šéåˆ—è¡¨å®šç¾©é¢å…ƒï¼Œç„¶å¾Œå†é€šé pd.cut()å‡½æ•¸å°æ•¸æ“šé€²è¡ŒåŠƒåˆ†ã€‚**

```python
data = np.random.randint(0, 100, 50)
bins = [0, 25, 50, 75, 100]
print(data)
print()
print(pd.cut(data, bins))
----------------------------------------
[70 10 99 92  9 48 68 66 38 12  5 62 89 56 59 88  4 93 87  7  3 22 78 75
 30 62 46 60 51 64 29 52  8 40 90  7  8 44 49 47 29 49 28 79  7 43 12 33
 29 30]

[(50, 75], (0, 25], (75, 100], (75, 100], (0, 25], ..., (25, 50], (0, 25], (25, 50], (25, 50], (25, 50]]
Length: 50
Categories (4, interval[int64]): [(0, 25] < (25, 50] < (50, 75] < (75, 100]]

```

â€‹	

**è‹¥åœ¨èª¿ç”¨cut() å‡½æ•¸æ™‚ä¸æŒ‡å®šé¢å…ƒçš„å„ç•Œé™ï¼Œè€Œæ˜¯åƒ…åƒ…å‚³å…¥ä¸€å€‹æ•´æ•¸ä½œçˆ²åƒæ•¸ï¼Œ cut()æœƒæŒ‰ç…§æŒ‡å®šçš„æ•¸å­—å°‡å…ƒç´ æŒ‰ç…§ç¯„åœåŠƒåˆ†ç‚ºç›¸æ‡‰çš„å¹¾éƒ¨åˆ†ã€‚**

â€‹	**æ³¨æ„ï¼šé€™è£æ˜¯æŒ‰ç…§æ•¸å­—å°‡å…ƒç´ åŠƒçˆ²ç­‰åˆ†çš„å€åŸŸï¼Œå¹¶ä¸ä»£è¡¨è‘—æ¯å€‹å€åŸŸä¸­çš„å…ƒç´ å€‹æ•¸éƒ½æ˜¯ç›¸åŒçš„ã€‚**

```python
data = np.random.randint(0, 100, 50)
bins = [0, 25, 50, 75, 100]
print(pd.cut(data, 5))
---------------------------------
[(-0.097, 19.4], (19.4, 38.8], (77.6, 97.0], (58.2, 77.6], (58.2, 77.6], ..., (-0.097, 19.4], (38.8, 58.2], (-0.097, 19.4], (-0.097, 19.4], (77.6, 97.0]]
Length: 50
Categories (5, interval[float64]): [(-0.097, 19.4] < (19.4, 38.8] < (38.8, 58.2] < (58.2, 77.6] <
                                    (77.6, 97.0]]
```



### æ¬¡æ•¸è¨ˆç®—

â€‹	**é€šé pd.value_counts() å‡½æ•¸å¯ä»¥è¨ˆç®—å„å€‹é¢å…ƒå‡ºç¾çš„æ¬¡æ•¸ã€‚**

```python
ata = np.random.randint(0, 100, 50)
bins = [0, 25, 50, 75, 100]
cut_result = pd.cut(data,bins)
print(pd.value_counts(cut_result))
-----------------------------------------
(75, 100]    18
(50, 75]     12
(25, 50]     11
(0, 25]       9
dtype: int64
```



â€‹	**é€šé cut_result(é€™æ˜¯å€‹è®Šé‡å) .codes å¯ä»¥å¾—å‡ºå„å€‹å…ƒç´ å±¬æ–¼å“ªå€‹é¢å…ƒã€‚ï¼ˆå…¶ä¸­é¢å…ƒå¾0é–‹å§‹è‡³len(arr) - 1ï¼Œä¹Ÿå°±æ˜¯é¢å…ƒåŠƒåˆ†çš„å„å€‹ä¸‹æ¨™ï¼‰**

```python
data = np.random.randint(0, 100, 50)
bins = [0, 25, 50, 75, 100]
print(cut_result.codes)
-------------------------------------
[3 2 0 1 1 2 1 0 1 1 2 3 1 0 0 3 3 0 2 3 3 3 1 0 1 1 2 1 0 2 1 0 0 2 1 1 3
 0 3 1 2 0 3 2 3 0 2 0 0 2]
```



### åç¨±æŒ‡å®š

â€‹	**é€šéä¸€å€‹Xå…ƒçš„åˆ—è¡¨ï¼ˆå…¶ä¸­X æ‡‰èˆ‡é¢å…ƒçš„å€‹æ•¸ä¿æŒä¸€è‡´ï¼Œæ‰èƒ½é”åˆ°åç¨±æŒ‡å®šï¼ˆ1å°1ï¼‰çš„ä½œç”¨ï¼‰ï¼Œä¾†æŒ‡å®šé¢å…ƒçš„åç¨±ã€‚å…¶ä¸­éœ€ä¸»è¦çš„æ˜¯ï¼Œåœ¨èª¿ç”¨ cut å‡½æ•¸æ™‚éœ€é¡¯æ€§å¯«å‡ºåƒæ•¸ labels =** 

```python
data = np.random.randint(0, 100, 50)
bins = [0, 25, 50, 75, 100]
bin_names = ["unlikely", "less likely", "likely", "high likely"]
print(pd.cut(data, bins, labels=bin_names))
-------------------------------------------------
['unlikely', 'likely', 'less likely', 'less likely', 'likely', ..., 'high likely', 'less likely', 'unlikely', 'high likely', 'high likely']
Length: 50
Categories (4, object): ['unlikely' < 'less likely' < 'likely' < 'high likely']
```





## æ’åº

### æ”¹è®Šè¡Œæ’åˆ—æˆ–åˆ—æ’åˆ—

â€‹	**é€šé DataFrame.take()å³å¯ä»¥å¯¦ç¾å°è¡Œæ’ä½æˆ–åˆ—æ’ä½çš„æ”¹è®Šã€‚ä¸é›£æƒ³åˆ°ï¼Œæ­¤è™•åŒæ¨£å¯ä»¥é€šéå°åƒæ•¸ axis çš„æ§åˆ¶ä¾†å¯¦ç¾å°è¡Œæˆ–æ˜¯å°åˆ—çš„æ“ä½œã€‚**

```python
df = pd.DataFrame(np.arange(25).reshape(5, 5))
new_order = np.random.permutation(5)
print(new_order)
print()
print(df.take(new_order))
-------------------------------------------
[2 3 1 4 0]

    0   1   2   3   4
2  10  11  12  13  14
3  15  16  17  18  19
1   5   6   7   8   9
4  20  21  22  23  24
0   0   1   2   3   4
```

â€‹	**æ­¤è™•ï¼Œè£œå……ä¸€ä¸‹random.permutation()ã€‚é€™å€‹å‡½æ•¸ç”¨æ–¼å‰µå»ºä¸€å€‹åŒ…å«0 è‡³ x ï¼ˆä¸åŒ…æ‹¬x)æœ‰ x å€‹æ•´æ•¸çš„æ•¸çµ„ã€‚é€™ X å€‹æ•¸å‡æœƒè¢«åŒ…æ‹¬ï¼Œä½†å…¶å‡ºç¾çš„é †åºå‰‡æ˜¯éš¨æ©Ÿçš„ã€‚**





## å­—ç¬¦ä¸²è™•ç†

> å¯èƒ½æœƒç”¨åˆ°çš„å‡½æ•¸ï¼š
>
> - .split()
> - .join()
> - .index()
> - .find()
> - .replace()



### æ­£å‰‡è¡¨é”å¼

**ï¼ˆæ²’æƒ³åˆ°é‚„æ˜¯é€ƒä¸éæ­£å‰‡ï¼‰**

â€‹	**é¦–å…ˆè¬›ä¸€ä¸‹ä»€éº½æ˜¯æ­£å‰‡è¡¨é”å¼ã€‚**

â€‹	**æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨å•ä¸ªå­—ç¬¦ä¸²æ¥æè¿°ã€åŒ¹é…ä¸€ç³»åˆ—åŒ¹é…æŸä¸ªå¥æ³•è§„åˆ™çš„å­—ç¬¦ä¸²ã€‚åœ¨å¾ˆå¤šæ–‡æœ¬ç·¨è¼¯å™¨é‡Œï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸è¢«ç”¨æ¥æ£€ç´¢ã€æ›¿æ¢é‚£äº›åŒ¹é…æŸä¸ªæ¨¡å¼çš„æ–‡æœ¬ã€‚**

â€‹	**(ä¸éè€å¸«è·³éäº†ï¼Œé‚£æˆ‘å€‘ä¹Ÿç•¥ã€‚**





## æ•¸æ“šèšåˆ

â€‹	**æ‰€è¬‚æ•¸æ“šèšåˆï¼Œå³æ˜¯å°‡æ•¸çµ„ä¸­çš„å¤šå€‹æ•¸æ“šé€²è¡Œæœƒèšï¼Œæœ€å¾Œç”Ÿæˆä¸€å€‹å–®ä¸€çš„æ•¸å€¼ã€‚**



### Groupby

â€‹	**åœ¨pandasä¸­ï¼Œæ•¸æ“šçš„èšåˆé€šé Groupby() å‡½æ•¸ï¼Œç”Ÿæˆä¸€å€‹ Groupbyå°è±¡ï¼Œå…·é«”çš„ä¿¡æ¯å‡å¯é€šé Groupby ç²å–ã€‚**

```python
frame = pd.DataFrame({"color": ["red", "blue", "green"],
                      "object": ["pen", "ball", "pencil"],
                      "value":[5, 10, 15],
                      "value2":[20, 25,50]},)

print(frame["value"])
group = frame["value"].groupby(frame["color"])
print(group.groups)
print()
print(group.mean())
-----------------------------------
0     5
1    10
2    15
Name: value, dtype: int64
{'blue': [1], 'green': [2], 'red': [0]}

color
blue     10
green    15
red       5
Name: value, dtype: int64
```

â€‹	**é¡¯è€Œæ˜“è¦‹ï¼Œé€™å€‹ DataFrame é¦–å…ˆæ‡‰è©²æ˜¯ç”±æ•¸å€¼å’Œå­—ç¬¦ä¸²ä¸€èµ·æ§‹æˆçš„ã€‚**

â€‹	**åœ¨ä½¿ç”¨ groupby å‡½æ•¸æ™‚ï¼Œé¦–å…ˆæ‡‰æŒ‡å®šä½ æƒ³è¦èšé¡åœ¨å“ªå€‹æ–¹å‘ä¸Šï¼ˆæˆ–è€…ç¨±çˆ²å“ªå€‹å±¬æ€§ä¸Šï¼‰ï¼Œå°‡å…¶å‚³éåœ¨åƒæ•¸ä¸­ï¼›ç„¶å¾Œç”¨è¢«èšé¡çš„å±¬æ€§ä¾†èª¿ç”¨é€™å€‹ groupby() å‡½æ•¸ï¼Œå°±å¦‚ä¸Šè¿°ä»£ç¢¼ä¸­çš„ï¼šframe["value"].groupby(frame["color"])ï¼Œå¯ç†è§£ç‚º A is grouped by (B)ã€‚**

â€‹	**è‹¥æƒ³æŸ¥çœ‹ group å°è±¡ï¼Œéœ€ä½¿ç”¨å±¬æ€§ groups è€Œéç›´æ¥ print()ï¼›å¦å¤–ï¼Œ.mean()ï¼Œ.max() é€™äº›æ–¹æ³•è‚¯å®šä¹Ÿæ˜¯æœƒå…·æœ‰çš„ã€‚**



### ç­‰ç´šåˆ†çµ„

â€‹	**ç•¶ç„¶ï¼Œå¯ä»¥æ ¹æ“šä¸€åˆ—ä¾†é€²è¡Œèšé¡ï¼Œå°±å¯ä»¥æ ¹æ“šå¤šç´¯ä¾†é€²è¡Œèšé¡ã€‚åªéœ€åœ¨å‚³å…¥åƒæ•¸æ™‚å¤šå¯«å¹¾å€‹é€²å»å°±å¯ä»¥äº†ã€‚ï¼ˆç°¡å–®å§**

â€‹	**å¦å¤–ï¼Œè¢«èšé¡çš„æ•¸æ“šåŒæ™‚ä¹Ÿå¯ä»¥ä¸æ­¢ä¸€å€‹å±¬æ€§å“¦~**

â€‹	**ps:æ‰€ä»¥é€™ç¨®æ–¹æ³•çˆ²ä»€éº½å«ç­‰ç´šåˆ†çµ„å‘¢ï¼Ÿ**

```
frame = pd.DataFrame({"color": ["red", "blue", "green"],
                      "object": ["pen", "ball", "pencil"],
                      "value":[5, 10, 15],
                      "value2":[20, 25,50]},)

group = frame[["value", "value2"]].groupby(frame["color"])
print(group.groups)
print()
print(group.mean())
print("==========================")
print(frame.groupby(frame["object"]).mean())
--------------------------------
{'blue': [1], 'green': [2], 'red': [0]}

       value  value2
color               
blue      10      25
green     15      50
red        5      20
==========================
        value  value2
object               
ball       10      25
pen         5      20
pencil     15      50
```

â€‹	**ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œç•¶å–®ç¨ä½¿ç”¨ frame.groupby() è€Œä¸æŒ‡å®šè¢«èšé¡å±¬æ€§æ™‚ï¼Œå…¶æœƒè‡ªå‹•é¸æ“‡ DataFrame å°è±¡ä¸­çš„ ç‚ºæ•¸å€¼çš„ å±¬æ€§ï¼Œè€Œéç”±å­—ç¬¦ä¸²çµ„æˆçš„å±¬æ€§ã€‚**



### çµ„è¿­ä»£

â€‹	**.groupby() å‡½æ•¸è¿”å›çš„æ˜¯ä¸€å€‹å¯è¿­ä»£å°è±¡ï¼Œå…¶çµ„æˆé¡ä¼¼æ–¼ dict ä¸­çš„ (key, value) éµå€¼å°ã€‚**

```python
import pandas as pd
import numpy as np

frame = pd.DataFrame({"color": ["red", "blue", "green"],
                      "object": ["pen", "ball", "pencil"],
                      "value":[5, 10, 15],
                      "value2":[20, 25,50]},)

for name, group in frame.groupby(frame["color"]):
    print(name)
    print(group)
----------------------------------
blue
  color object  value  value2
1  blue   ball     10      25
green
   color  object  value  value2
2  green  pencil     15      50
red
  color object  value  value2
0   red    pen      5      20
```



## éˆå¼è½‰æ›

â€‹	**éˆå¼è½‰æ›çœ‹èµ·ä¾†å¯èƒ½æœƒå¾ˆé…·ï¼Œä½†å¯¦éš›ä¸Šå¹¶ä¸æ¨è–¦å¤§å®¶ä½¿ç”¨ï¼ˆé„™äººç§è‡ªèªçˆ²ï¼‰ã€‚**

â€‹	**æ•…ä¸å†é€²è¡Œä»‹ç´¹ã€‚ï¼ˆä¸æ˜¯**



## åˆ†çµ„å‡½æ•¸

â€‹	**é€šéèª¿ç”¨å‡½æ•¸ quantile() è¨ˆç®—åˆ†ä½æ•¸å³å¯é”åˆ°åˆ†çµ„çš„æ•ˆæœã€‚æœ‰äº›åŒå­¸å¯èƒ½å°±ç–‘æƒ‘äº†ï¼Œåˆ†ä½æ•¸æ˜¯å€‹ä»€éº½æ±è¥¿ï¼Ÿä¸‹é¢ç°¡å–®ä»‹ç´¹ä¸€ä¸‹åˆ†ä½æ•¸ã€‚**

â€‹	**åˆ†ä½æ•¸æ˜¯ä¸€å€‹æ•¸å€¼ï¼Œå®ƒä»£è¡¨äº†åœ¨æ•´å€‹åºåˆ—ï¼ˆæˆ–åˆ—è¡¨ï¼‰ä¸­ï¼Œå‰ç™¾åˆ†ä¹‹å¤šå°‘çš„æ•¸æœƒå°æ–¼è©²æ•¸ã€‚ç”¨äººè©±ä¾†èª¬ï¼Œå°±æ˜¯å°‡æ•¸çµ„é€²è¡Œæ’åºï¼Œç„¶å¾Œåœ¨ç™¾åˆ†æ¯”å¤šå°‘çš„ä½ç½®å°æ•¸æ“šé€²è¡ŒåŠƒåˆ†ã€‚**

```
frame = pd.DataFrame({"color": ["red", "blue", "green"],
                      "object": ["pen", "ball", "pencil"],
                      "value":[5, 10, 15],
                      "value2":[20, 25,50]},)

print(frame.quantile(0.6))
---------------------------------
value     11.0
value2    30.0
Name: 0.6, dtype: float64
```

â€‹	**ä¸€èˆ¬ä¾†èª¬ï¼Œåˆ†çµ„å‡½æ•¸å¯ä»¥é…åˆ groupby() ä¸€èµ·ä½¿ç”¨ã€‚å°‡æ•¸çµ„é€²æ•´é«”è¡Œåˆ†çµ„åå†é€²è¡Œå†…éƒ¨åŠƒåˆ†ã€‚**



## è‡ªå®šç¾©èšé¡å‡½æ•¸

â€‹	**é€šé .agg() å¯ä»¥å¯¦ç¾è‡ªå®šç¾©èšé¡å‡½æ•¸çš„åŠŸèƒ½å“¦ã€‚**

```python

frame = pd.DataFrame(np.arange(9).reshape(3, 3),
                        columns = ["red", "blue", "green"],
                      index =  ["pen", "ball", "pencil"])

group = frame.groupby(frame.index)

print(group.mean())
print()
print(group.agg(mydef))
print()
print(frame.agg(mydef))
----------------------------------------------
       red  blue  green
ball      3     4      5
pen       0     1      2
pencil    6     7      8

        red  blue  green
ball      0     0      0
pen       0     0      0
pencil    0     0      0

red      6
blue     6
green    6
dtype: int64
```



## é«˜ç´šæ•¸æ“šèšåˆ

**ï¼ˆå¾ˆé›£ä¸æ‡·ç–‘çˆ²ä»€éº½æ•™ææŠŠé€™å€‹å†…å®¹æ”¾åœ¨ç« ç¯€æœ«ï¼‰**

â€‹	**éœ€è¦ä½¿ç”¨åˆ°çš„å‡½æ•¸ï¼š**

> - .transform()
> - .apply()



**ç¤ºä¾‹å¦‚ä¸‹ï¼š**

â€‹	**add_prefix() ç”¨æ–¼ä¿®æ”¹indexï¼Œgroupby()ç”¨æ–¼åœ¨ color(æœ¬ä¾‹ä¸­ï¼‰é€²è¡Œèšé¡ã€‚**

â€‹	**.transform(func) å…¶ä¸­func æ˜¯ç”¨æ–¼è½‰æ›çš„å‡½æ•¸ï¼Œæ—¢å¯ä»¥å‚³å…¥è‡ªå®šç¾©å‡½æ•¸ï¼Œä¹Ÿå¯ä»¥å‚³å…¥åº«ä¸­æ‰€åŒ…æ‹¬çš„å‡½æ•¸ã€‚**

```

frame = pd.DataFrame({"color": ["white", "red", "green", "red", "green"],
                      "price1":[2, 5, 7, 9, 10],
                      "price2":[11, 33, 55, 77, 99]})

print(frame.groupby(frame["color"]).transform(np.sum).add_prefix("tot_"))
---------------------------------
   tot_price1  tot_price2
0           2          11
1          14         110
2          17         154
3          14         110
4          17         154
```



**apply() å‡½æ•¸é©ç”¨æ–¼æ›´åŠ é€šç”¨çš„ Groupby() æ“ä½œã€‚**

```python
frame = pd.DataFrame({"color": ["white", "black", "white", "black", "white"],
                      "status":["up", "up", "down", "down", "down"],
                      "value1":[12, 13, 15, 16, 17],
                      "value2": [21, 25, 26, 27, 29]})

print(frame.groupby(["color", "status"]).apply(lambda x:x.max()))
-----------------------------------------------
			  color status  value1  value2
color status                              
black down    black   down      16      27
      up      black     up      13      25
white down    white   down      17      29
      up      white     up      12      21

```

â€‹	**æ³¨ï¼šå¦‚æœæ²’çœ‹æ‡‚ï¼Œå…¶å¯¦ä¹Ÿæ²’æœ‰é—œä¿‚ã€‚**